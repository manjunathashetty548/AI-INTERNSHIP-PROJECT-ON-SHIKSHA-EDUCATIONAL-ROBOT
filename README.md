"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     ğŸ¤– SHIKSHA ROBOT PROJECT ğŸ“                          â•‘
â•‘              âœ¨ AI-Integrated Educational Assistant System âœ¨            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PROJECT OVERVIEW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
SHIKSHA Robot is an innovative educational bot developed at Experimind Labs
to support experiential STEM learning in resource-constrained classrooms.
Designed as an interactive teaching assistant, it uses barcode scanning to
detect educational charts and narrates stories or lessons aloud, making
learning engaging and accessible for students.

ğŸ¯ OBJECTIVES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ¨ Develop affordable, scalable educational robot for government schools
  ğŸ¨ Enable interactive learning through voice narration and visual engagement
  ğŸ“Š Use barcode-based chart recognition to trigger relevant educational content
  ğŸ”§ Build durable, modular design for long-term classroom use
  ğŸ’° Minimize production costs without compromising functionality

ğŸ” SCOPE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ¯ Target Audience: Government schools and budget-constrained institutions
  ğŸ“š Application: Interactive teaching assistant for STEM education
  ğŸš€ Scalability: Designed for mass production (8 units deployed)
  ğŸ’¡ Technology: Robotics + AI + Embedded Systems + Educational Content
  ğŸŒŸ Social Impact: Making technology-driven education accessible to all

ğŸ¢ ABOUT EXPERIMIND LABS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ”¬ EdTech startup innovating in experiential STEM education
  ğŸ Products: Shiksha Robot, Anubhav Kit, Prasthuti Platform, P-STEM Labs
  ğŸŒ‰ Focus: Bridging theoretical learning with hands-on application
  ğŸŒˆ Mission: Multilingual, accessible learning for diverse schools

ğŸ¤– KEY FEATURES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“¸ Barcode-based chart detection (98.5% accuracy)
  ğŸ¤ Pre-loaded educational content narration
  ğŸ˜Š NeoPixel LED facial expressions (64 LEDs)
  ğŸ‘‚ Servo-controlled ear movements for engagement
  ğŸ›¡ï¸ Durable chassis (MDF, SS Steel, MS Steel)
  âš¡ Buck converter power management system
  ğŸ”‹ 6-8 hours battery life
  âš¡ Response time < 0.5 seconds

ğŸ”§ HARDWARE COMPONENTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ§  Microcontroller : Raspberry Pi 4
  ğŸ“· Scanner         : Barcode Scanner Module (Serial)
  âœ¨ Display         : NeoPixel LED Matrix (64 pixels)
  ğŸ­ Motors          : 2x SG90 Servo Motors
  ğŸ”Š Audio           : Amplifier Module + 5W Speaker
  ğŸ”‹ Power           : 12V Battery + Buck Converter
  ğŸ—ï¸ Chassis         : MDF Board, SS Steel, MS Steel

ğŸ’» SOFTWARE STACK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ Python 3.x (Primary language)
  ğŸ® RPi.GPIO (Servo control)
  ğŸ’¡ Adafruit NeoPixel (LED control)
  ğŸµ PyGame (Audio playback)
  ğŸ“¡ PySerial (Barcode scanner interface)
  âš¡ SMBus (Power monitoring)

âš™ï¸ HOW IT WORKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Step 1: ğŸ“Š Chart Detection
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Teacher shows educational chart â†’ Barcode scanner reads ID    â”‚
  â”‚  â±ï¸ Detection Time: < 0.2 seconds                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 2: ğŸ¤” Content Processing
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Robot displays "thinking" face â†’ Loads audio content          â”‚
  â”‚  ğŸ’™ Blue eyes + Ears perk up                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 3: ğŸ‰ Engaging Students
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Excited expression â†’ Ears wiggle â†’ Students' attention!       â”‚
  â”‚  ğŸ’š Cyan eyes + Big smile + Animated movements                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 4: ğŸ¤ Content Delivery
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Audio narration plays â†’ Listening expression shown            â”‚
  â”‚  ğŸµ Crystal clear audio + Visual feedback                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 5: âœ… Mission Complete
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Happy face returns â†’ Ready for next chart                     â”‚
  â”‚  ğŸ˜Š Green eyes + Yellow smile                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ’ "Empowering education through robotics"                              â•‘
â•‘  ğŸŒŸ Making learning interactive, accessible, and fun for every student!  â•‘
â•‘                                                                          â•‘
â•‘  ğŸ¢ Developed at Experimind Labs                                         â•‘
â•‘  ğŸ‘¥ Team Size: 7 | ğŸ¯ Mentor: Mr. Adarsh Guruprasad Devadiga (CTO)     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import serial
import time
import board
import neopixel
import RPi.GPIO as GPIO
import pygame
import os
import smbus
from random import randint

# ============================================================================
# ğŸ¨ COLORFUL CONFIGURATION SETTINGS ğŸ¨
# ============================================================================

CONFIG = {
    "barcode_scanner": {
        "port": "/dev/ttyUSB0",
        "baudrate": 9600
    },
    "neopixel": {
        "pin": board.D18,
        "num_pixels": 64,
        "brightness": 0.5
    },
    "servo": {
        "left_pin": 17,
        "right_pin": 27
    },
    "audio": {
        "directory": "audio_files",
        "volume": 0.8
    },
    "power": {
        "i2c_address": 0x48,
        "low_battery_threshold": 20
    }
}

# ğŸ¨ Color Palette for Expressions
COLORS = {
    'happy_eyes': (0, 255, 0),       # ğŸ’š Bright Green
    'happy_smile': (255, 255, 0),    # ğŸ’› Sunny Yellow
    'thinking_eyes': (0, 100, 255),  # ğŸ’™ Sky Blue
    'thinking_mouth': (150, 150, 200), # ğŸ’œ Soft Purple
    'excited_eyes': (0, 255, 255),   # ğŸ’ Cyan Diamond
    'excited_smile': (255, 200, 0),  # ğŸŒŸ Golden Star
    'listening_eyes': (0, 255, 150), # ğŸ’š Emerald Green
    'listening_smile': (200, 200, 0), # ğŸ’› Soft Gold
    'rainbow': [
        (255, 0, 0),    # â¤ï¸ Red
        (255, 127, 0),  # ğŸ§¡ Orange
        (255, 255, 0),  # ğŸ’› Yellow
        (0, 255, 0),    # ğŸ’š Green
        (0, 0, 255),    # ğŸ’™ Blue
        (75, 0, 130),   # ğŸ’œ Indigo
        (148, 0, 211)   # ğŸ’œ Violet
    ]
}

# ============================================================================
# ğŸ“· BARCODE SCANNER MODULE ğŸ“·
# ============================================================================

class BarcodeScanner:
    """
    ğŸ” Barcode Scanner Module - The Robot's Eyes!
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Reads educational chart barcodes with lightning-fast speed! âš¡
    """
    
    def __init__(self, port='/dev/ttyUSB0', baudrate=9600):
        try:
            self.serial_port = serial.Serial(port, baudrate, timeout=1)
            print(f"âœ… ğŸ“· Barcode Scanner Ready! Port: {port}")
        except Exception as e:
            print(f"âŒ ğŸ“· Scanner Error: {e}")
            self.serial_port = None
        
    def read_barcode(self):
        """ğŸ” Scan and detect chart barcodes"""
        if self.serial_port and self.serial_port.in_waiting > 0:
            try:
                barcode_data = self.serial_port.readline().decode('utf-8').strip()
                return barcode_data
            except Exception as e:
                return None
        return None
    
    def close(self):
        """ğŸ‘‹ Goodbye scanner!"""
        if self.serial_port:
            self.serial_port.close()
            print("âœ… ğŸ“· Scanner closed gracefully")


# ============================================================================
# ğŸ˜Š NEOPIXEL LED FACIAL EXPRESSION MODULE ğŸ˜Š
# ============================================================================

class FacialExpression:
    """
    âœ¨ Facial Expression Controller - The Robot's Emotions! âœ¨
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    64 colorful LEDs bringing the robot to life with adorable expressions!
    """
    
    def __init__(self, pin=board.D18, num_pixels=64, brightness=0.5):
        try:
            self.pixels = neopixel.NeoPixel(
                pin, 
                num_pixels, 
                brightness=brightness,
                auto_write=False
            )
            print(f"âœ… âœ¨ NeoPixel LEDs Ready! ({num_pixels} colorful pixels)")
            self.rainbow_cycle()  # ğŸŒˆ Startup rainbow animation!
        except Exception as e:
            print(f"âŒ âœ¨ LED Error: {e}")
            self.pixels = None
    
    def rainbow_cycle(self):
        """ğŸŒˆ Beautiful rainbow startup animation"""
        if not self.pixels:
            return
        
        for color in COLORS['rainbow']:
            self.pixels.fill(color)
            self.pixels.show()
            time.sleep(0.1)
        self.pixels.fill((0, 0, 0))
        self.pixels.show()
    
    def happy_face(self):
        """ğŸ˜Š Happy Expression - Default welcoming state!"""
        if not self.pixels:
            return
            
        self.pixels.fill((0, 0, 0))
        
        # ğŸ’š Sparkling Green Eyes
        eye_positions = [18, 19, 20, 21, 22, 23, 41, 42, 43, 44, 45, 46]
        for pos in eye_positions:
            self.pixels[pos] = COLORS['happy_eyes']
        
        # ğŸ’› Bright Yellow Smile
        smile_positions = [48, 49, 50, 51, 52, 53, 54, 55, 40, 47, 56, 39]
        for pos in smile_positions:
            self.pixels[pos] = COLORS['happy_smile']
        
        # âœ¨ Rosy Cheeks
        cheek_positions = [26, 29]
        for pos in cheek_positions:
            self.pixels[pos] = (255, 105, 180)  # ğŸŒ¸ Pink cheeks!
            
        self.pixels.show()
        print("ğŸ˜Š Happy face displayed!")
    
    def thinking_face(self):
        """ğŸ¤” Thinking Expression - Processing mode!"""
        if not self.pixels:
            return
            
        self.pixels.fill((0, 0, 0))
        
        # ğŸ’™ Thoughtful Blue Eyes
        eye_positions = [18, 19, 21, 22, 42, 43, 45, 46]
        for pos in eye_positions:
            self.pixels[pos] = COLORS['thinking_eyes']
        
        # ğŸ’œ Neutral Mouth
        mouth_positions = [50, 51, 52, 53]
        for pos in mouth_positions:
            self.pixels[pos] = COLORS['thinking_mouth']
        
        # ğŸ’« Thinking stars
        star_positions = [2, 5, 58, 61]
        for pos in star_positions:
            self.pixels[pos] = (255, 255, 255)  # â­ Twinkle stars
            
        self.pixels.show()
        print("ğŸ¤” Thinking face activated!")
    
    def excited_face(self):
        """ğŸ¤© Excited Expression - Maximum engagement!"""
        if not self.pixels:
            return
            
        self.pixels.fill((0, 0, 0))
        
        # ğŸ’ Wide Sparkling Eyes
        eye_positions = [17, 18, 19, 20, 21, 22, 25, 26, 
                        41, 42, 43, 44, 45, 46, 37, 38]
        for pos in eye_positions:
            self.pixels[pos] = COLORS['excited_eyes']
        
        # ğŸŒŸ Huge Golden Smile
        smile_positions = [48, 49, 50, 51, 52, 53, 54, 55, 
                          40, 47, 56, 39, 32, 31]
        for pos in smile_positions:
            self.pixels[pos] = COLORS['excited_smile']
        
        # ğŸ‰ Excitement sparkles
        sparkle_positions = [0, 7, 56, 63, 3, 4]
        for pos in sparkle_positions:
            self.pixels[pos] = (255, 255, 255)  # âœ¨ Sparkles!
            
        self.pixels.show()
        print("ğŸ¤© Excited face - WOW!")
    
    def listening_face(self):
        """ğŸ‘‚ Listening Expression - Attentive mode!"""
        if not self.pixels:
            return
            
        self.pixels.fill((0, 0, 0))
        
        # ğŸ’š Attentive Emerald Eyes
        eye_positions = [18, 19, 20, 21, 22, 42, 43, 44, 45, 46]
        for pos in eye_positions:
            self.pixels[pos] = COLORS['listening_eyes']
        
        # ğŸ’› Gentle Smile
        smile_positions = [49, 50, 51, 52, 53, 54]
        for pos in smile_positions:
            self.pixels[pos] = COLORS['listening_smile']
        
        # ğŸµ Musical notes
        note_positions = [10, 13]
        for pos in note_positions:
            self.pixels[pos] = (0, 255, 255)  # ğŸµ Cyan notes
            
        self.pixels.show()
        print("ğŸ‘‚ Listening face - I'm all ears!")
    
    def heart_animation(self):
        """ğŸ’– Love animation for special moments!"""
        if not self.pixels:
            return
        
        # ğŸ’– Heart shape pattern
        heart_positions = [
            18, 21, 26, 29,  # Top of heart
            17, 22, 25, 30,  # Upper middle
            34, 37,          # Middle
            42, 45,          # Lower middle
            51               # Bottom point
        ]
        
        # Animate heart beating
        for _ in range(3):
            self.pixels.fill((0, 0, 0))
            for pos in heart_positions:
                self.pixels[pos] = (255, 20, 147)  # ğŸ’– Deep pink
            self.pixels.show()
            time.sleep(0.3)
            
            self.pixels.fill((0, 0, 0))
            for pos in heart_positions:
                self.pixels[pos] = (255, 105, 180)  # ğŸ’— Light pink
            self.pixels.show()
            time.sleep(0.3)
        
        print("ğŸ’– Sending love!")
    
    def star_twinkle(self):
        """â­ Twinkling stars animation"""
        if not self.pixels:
            return
        
        for _ in range(5):
            self.pixels.fill((0, 0, 50))  # Dark blue night
            # Random twinkling stars
            for _ in range(10):
                pos = randint(0, 63)
                self.pixels[pos] = (255, 255, 255)
            self.pixels.show()
            time.sleep(0.2)
        
        print("â­ Twinkling stars!")
    
    def clear(self):
        """ğŸŒ‘ Clear all LEDs"""
        if self.pixels:
            self.pixels.fill((0, 0, 0))
            self.pixels.show()


# ============================================================================
# ğŸ‘‚ SERVO MOTOR CONTROL MODULE ğŸ‘‚
# ============================================================================

class ServoController:
    """
    ğŸ­ Servo Controller - The Robot's Expressive Ears! ğŸ­
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Adorable ear movements that make students smile!
    """
    
    def __init__(self, left_pin=17, right_pin=27):
        try:
            GPIO.setmode(GPIO.BCM)
            GPIO.setup(left_pin, GPIO.OUT)
            GPIO.setup(right_pin, GPIO.OUT)
            
            self.left_servo = GPIO.PWM(left_pin, 50)
            self.right_servo = GPIO.PWM(right_pin, 50)
            
            self.left_servo.start(0)
            self.right_servo.start(0)
            print(f"âœ… ğŸ‘‚ Servo Ears Ready to wiggle!")
        except Exception as e:
            print(f"âŒ ğŸ‘‚ Servo Error: {e}")
            self.left_servo = None
            self.right_servo = None
    
    def set_angle(self, servo, angle):
        """ğŸ¯ Set precise ear angle"""
        if not servo:
            return
            
        duty_cycle = 2 + (angle / 18)
        servo.ChangeDutyCycle(duty_cycle)
        time.sleep(0.3)
        servo.ChangeDutyCycle(0)
    
    def wiggle_ears(self, times=3):
        """ğŸª Adorable ear wiggle dance!"""
        if not self.left_servo or not self.right_servo:
            return
            
        print(f"ğŸ­ Wiggling ears {times} times - So cute!")
        for _ in range(times):
            self.set_angle(self.left_servo, 45)
            self.set_angle(self.right_servo, 135)
            time.sleep(0.2)
            self.set_angle(self.left_servo, 135)
            self.set_angle(self.right_servo, 45)
            time.sleep(0.2)
    
    def perk_up(self):
        """ğŸ‘€ Ears perk up - Attention mode!"""
        if not self.left_servo or not self.right_servo:
            return
            
        print("ğŸ‘‚ Ears perked up - Listening carefully!")
        self.set_angle(self.left_servo, 45)
        self.set_angle(self.right_servo, 45)
    
    def neutral_position(self):
        """ğŸ˜Œ Relaxed ear position"""
        if not self.left_servo or not self.right_servo:
            return
            
        self.set_angle(self.left_servo, 90)
        self.set_angle(self.right_servo, 90)
    
    def excited_wiggle(self):
        """ğŸ‰ Super excited ear dance!"""
        if not self.left_servo or not self.right_servo:
            return
        
        print("ğŸ‰ Super excited ear dance!")
        for _ in range(2):
            self.set_angle(self.left_servo, 30)
            self.set_angle(self.right_servo, 150)
            time.sleep(0.15)
            self.set_angle(self.left_servo, 150)
            self.set_angle(self.right_servo, 30)
            time.sleep(0.15)
    
    def cleanup(self):
        """ğŸ§¹ Cleanup GPIO"""
        if self.left_servo:
            self.left_servo.stop()
        if self.right_servo:
            self.right_servo.stop()
        GPIO.cleanup()


# ============================================================================
# ğŸµ AUDIO PLAYBACK SYSTEM ğŸµ
# ============================================================================

class AudioPlayer:
    """
    ğŸ”Š Audio Player - The Robot's Voice! ğŸ”Š
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Crystal clear narration for engaging educational content!
    """
    
    def __init__(self, audio_directory="audio_files", volume=0.8):
        try:
            pygame.mixer.init()
            pygame.mixer.music.set_volume(volume)
            self.audio_dir = audio_directory
            self.audio_files = self._load_audio_files()
            print(f"âœ… ğŸµ Audio System Ready! ({len(self.audio_files)} lessons loaded)")
        except Exception as e:
            print(f"âŒ ğŸµ Audio Error: {e}")
            self.audio_files = {}
    
    def _load_audio_files(self):
        """ğŸ“š Load educational content library"""
        audio_dict = {}
        if os.path.exists(self.audio_dir):
            for file in os.listdir(self.audio_dir):
                if file.endswith(('.mp3', '.wav')):
                    barcode = file.split('.')[0]
                    audio_dict[barcode] = os.path.join(self.audio_dir, file)
                    print(f"  ğŸ“– Loaded: {barcode}")
        else:
            print(f"  ğŸ“ Create folder: mkdir {self.audio_dir}")
        return audio_dict
    
    def play_audio(self, barcode):
        """ğŸ¤ Play educational narration"""
        if barcode in self.audio_files:
            try:
                pygame.mixer.music.load(self.audio_files[barcode])
                pygame.mixer.music.play()
                print(f"ğŸµ Now playing: {barcode}")
                return True
            except Exception as e:
                print(f"âŒ Playback error: {e}")
                return False
        else:
            print(f"âš ï¸ No audio for: {barcode}")
            return False
    
    def stop_audio(self):
        """ğŸ”‡ Stop playback"""
        pygame.mixer.music.stop()
    
    def is_playing(self):
        """ğŸµ Check if narration is ongoing"""
        return pygame.mixer.music.get_busy()


# ============================================================================
# ğŸ”‹ POWER MANAGEMENT SYSTEM ğŸ”‹
# ============================================================================

class PowerManager:
    """
    âš¡ Power Manager - The Robot's Energy Monitor! âš¡
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Keeps the robot running strong all day long!
    """
    
    def __init__(self, i2c_address=0x48):
        try:
            self.bus = smbus.SMBus(1)
            self.address = i2c_address
            print(f"âœ… ğŸ”‹ Power Monitor Ready!")
        except Exception as e:
            print(f"âŒ ğŸ”‹ Power Monitor Error: {e}")
            self.bus = None
        
    def read_voltage(self):
        """âš¡ Read battery voltage"""
        if not self.bus:
            return 12.0
            
        try:
            data = self.bus.read_i2c_block_data(self.address, 0x02, 2)
            voltage = (data[0] << 8 | data[1]) * 0.004
            return voltage
        except:
            return 12.0
    
    def check_battery_status(self):
        """ğŸ”‹ Comprehensive battery health check"""
        voltage = self.read_voltage()
        
        min_voltage = 11.0
        max_voltage = 12.6
        
        percentage = ((voltage - min_voltage) / (max_voltage - min_voltage)) * 100
        percentage = max(0, min(100, percentage))
        
        if percentage > 70:
            status = "ğŸ’š Excellent"
            emoji = "ğŸ”‹"
        elif percentage > 50:
            status = "ğŸ’› Good"
            emoji = "ğŸ”‹"
        elif percentage > 20:
            status = "ğŸ§¡ Fair"
            emoji = "ğŸª«"
        else:
            status = "â¤ï¸ Low - Recharge Soon!"
            emoji = "ğŸª«"
        
        return {
            'voltage': voltage,
            'percentage': percentage,
            'status': status,
            'emoji': emoji
        }


# ============================================================================
# ğŸ¤– MAIN SHIKSHA ROBOT SYSTEM ğŸ¤–
# ============================================================================

class ShikshaRobot:
    """
    ğŸŒŸ SHIKSHA Robot - The Ultimate Teaching Companion! ğŸŒŸ
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Bringing joy and knowledge to classrooms everywhere!
    """
    
    def __init__(self):
        print("\n" + "â•"*70)
        print("  ğŸ¤–âœ¨ SHIKSHA ROBOT âœ¨ğŸ“")
        print("  ğŸ’ AI-Integrated Educational Assistant ğŸ’")
        print("  ğŸ¢ Developed at Experimind Labs ğŸ¢")
        print("â•"*70 + "\n")
        
        print("ğŸš€ Initializing Robot Subsystems...\n")
        
        self.scanner = BarcodeScanner(
            CONFIG['barcode_scanner']['port'],
            CONFIG['barcode_scanner']['baudrate']
        )
        
        self.face = FacialExpression(
            CONFIG['neopixel']['pin'],
            CONFIG['neopixel']['num_pixels'],
            CONFIG['neopixel']['brightness']
        )
        
        self.servo = ServoController(
            CONFIG['servo']['left_pin'],
            CONFIG['servo']['right_pin']
        )
        
        self.audio = AudioPlayer(
            CONFIG['audio']['directory'],
            CONFIG['audio']['volume']
        )
        
        self.power = PowerManager(CONFIG['power']['i2c_address'])
        
        self.last_barcode = None
        self.running = False
        
        print("\n" + "â•"*70)
        print("âœ… ğŸ‰ ALL SYSTEMS GO! READY TO TEACH! ğŸ‰")
        print("â•"*70 + "\n")
    
    def start(self):
        """ğŸš€ Start the magical teaching journey!"""
        self.running = True
        print("ğŸŒŸ SHIKSHA ROBOT ACTIVATED! ğŸŒŸ\n")
        print("ğŸ’« Status: READY TO MAKE LEARNING FUN!")
        print("ğŸ“š Waiting for educational charts...\n")
        
        self.welcome_sequence()
        
        try:
            while self.running:
                self.main_loop()
                time.sleep(0.1)
        except KeyboardInterrupt:
            print("\n\nğŸ‘‹ Shutdown signal received...")
            self.shutdown()
    
    def welcome_sequence(self):
        """ğŸª Spectacular welcome show!"""
        print("ğŸ­ Starting welcome performance...\n")
        
        # ğŸŒˆ Rainbow animation
        self.face.rainbow_cycle()
        time.sleep(0.5)
